<modification>
	<id>tshirtecommerce</id>
	<version>4.0.0</version>
	<vqmver>2.3.2</vqmver>
	<author>Tshirtecommerce Team</author>
	
	<!-- disable quantity input on checkout screen -->
	<file name="catalog/view/theme/*/template/checkout/cart.tpl">
		<operation>
			<search position="after"><![CDATA[<td class="text-left"><?php echo $product['model']; ?></td>]]></search>
			<add><![CDATA[
				<!--
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[<td class="text-right"><?php echo $product['price']; ?></td>]]></search>
			<add><![CDATA[
				-->
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[<td class="text-right"><?php echo $product['price']; ?></td>]]></search>
			<add><![CDATA[
				<td class="text-left"><div class="input-group btn-block" style="max-width: 200px;">
                    <input disabled type="text" name="quantity[<?php echo $product['key']; ?>]" value="<?php echo $product['quantity']; ?>" size="1" class="form-control" />
                    <span class="input-group-btn">
                    <button type="button" data-toggle="tooltip" title="<?php echo $button_remove; ?>" class="btn btn-danger" onclick="cart.remove('<?php echo $product['key']; ?>');"><i class="fa fa-times-circle"></i></button></span></div></td>
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[<span class="label label-info"><?php echo $text_recurring_item; ?></span> <small><?php echo $product['recurring']; ?></small>]]></search>
			<add><![CDATA[
				<?php } ?>
				<br /> <br />
				<?php if( ! empty($product['order_id']) && $product['design_product_id'] != $product['order_id']) { ?>
				<a href="index.php?route=tshirtecommerce/designer&product_id=<?php echo $product['design_product_id'] ?>&parent_id=<?php echo $product['parent_id'] ?>&cart_id=<?php echo $product['order_id'] ?>" title="Click here to edit design"><?php echo $tshirtecommerce_designer_cart_edit ?></a>
			]]></add>
		</operation>
	</file>
	
	<!-- set cookie design when customer login to page -->
	<file name="catalog/controller/account/account.php">
		<operation>
			<search position="after"><![CDATA[$data['heading_title'] = $this->language->get('heading_title');]]></search>
			<add><![CDATA[
				$logged 		= array(
					'login' 		=> TRUE,
					'email' 		=> $this->customer->getEmail(),
					'id' 			=> $this->customer->isLogged()
				);
				$_SESSION['is_logged'] = $logged;
			]]></add>
		</operation>
	</file>
	
	<file name="catalog/controller/checkout/login.php">
		<operation>
			<search position="before"><![CDATA[$activity_data = array(]]></search>
			<add><![CDATA[
				$logged 		= array(
					'login' 		=> TRUE,
					'email' 		=> $this->customer->getEmail(),
					'id' 			=> $this->customer->getId()
				);
				$_SESSION['is_logged'] = $logged;
			]]></add>
		</operation>
	</file>
	<file name="catalog/controller/account/logout.php">
		<operation>
			<search position="after"><![CDATA[$this->customer->logout();]]></search>
			<add><![CDATA[
				unset($_SESSION['is_logged']);
			]]></add>
		</operation>
	</file>
	<!-- unset session login -->
	<file name="admin/controller/common/logout.php">
		<operation position="after">
			<search><![CDATA[$this->user->logout();]]></search>
			<add><![CDATA[
				unset($_SESSION['is_admin']);
			]]></add>
		</operation>
	</file>
	
	<!-- add right menu -->
	<file name="admin/controller/common/menu.php">
		<operation>
			<search position="before"><![CDATA[$data['installer']]]></search>
			<add><![CDATA[
				$data['designer_build'] = $this->url->link('catalog/tshirtecommerce/index', 'token=' . $this->session->data['token'], 'SSL');				
				$data['designer_settings'] = $this->url->link('module/tshirtecommerce', 'token=' . $this->session->data['token'], 'SSL');
				$data['designer_update'] = $this->url->link('catalog/tshirtecommerce/update', 'token=' . $this->session->data['token'], 'SSL');
			]]></add>
		</operation>		
	</file>	
	<file name="admin/view/template/common/menu.tpl">
		<operation>
			<search position="before"><![CDATA[<li id="extension">]]></search>
			<add><![CDATA[ 
				<li><a class="parent"><img src="https://tshirtecommerce.com/icon.png"/> <span>T-Shirt eCommerce</span></a>
					<ul>
						<li><a href="<?php echo $designer_build; ?>">Product Build</a></li>						
						<li><a href="<?php echo $designer_settings; ?>">Settings</a></li>
						<li><a href="<?php echo $designer_update; ?>">Update</a></li>
					</ul>
				</li>
			]]></add>
		</operation>		
	</file>
	
	<!-- add tab design in edit product -->
	<file name="admin/controller/catalog/product.php">
		<operation>
			<search position="replace"><![CDATA[catalog/product_form.tpl]]></search>
			<add><![CDATA[catalog/product_tshirtecommerce.tpl]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[$this->model_localisation_language->getLanguages();]]></search>
			<add><![CDATA[				
				if (isset($this->request->post['design_product_id']))
				{
					$data['design_product_id'] = $this->request->post['design_product_id'];
				} 
				elseif (isset($product_info['design_product_id']))
				{
					$data['design_product_id'] = $product_info['design_product_id'];
				} 
				else
				{
					$data['design_product_id'] = '';
				}
				if (isset($this->request->post['design_product_title_img']))
				{
					$data['design_product_title_img'] = $this->request->post['design_product_title_img'];
				}
				elseif (isset($product_info['design_product_title_img']))
				{
					$data['design_product_title_img'] = $product_info['design_product_title_img'];
				} 
				else
				{
					$data['design_product_title_img'] = '';
				}				
			]]></add>
		</operation>
	</file>
	
	<!-- save value to database -->
	<file name="admin/model/catalog/product.php">
		<operation>
			<search position="after"><![CDATA[$product_id = $this->db->getLastId();]]></search>
			<add><![CDATA[
				if (isset($data['design_product_id'])) {
					$this->db->query("UPDATE " . DB_PREFIX . "product SET design_product_id = '" . $this->db->escape($data['design_product_id']) . "' WHERE product_id = '" . (int)$product_id . "'");
				}
				if (isset($data['design_product_title_img'])) {
					$this->db->query("UPDATE " . DB_PREFIX . "product SET design_product_title_img = '" . $this->db->escape($data['design_product_title_img']) . "' WHERE product_id = '" . (int)$product_id . "'");
				}
			]]></add>
		</operation>
		<operation>			
			<search position="after"><![CDATA[$this->event->trigger('pre.admin.product.edit', $data);]]></search>
			<add><![CDATA[
				if (isset($data['design_product_id'])) {
					$this->db->query("UPDATE " . DB_PREFIX . "product SET design_product_id = '" . $this->db->escape($data['design_product_id']) . "' WHERE product_id = '" . (int)$product_id . "'");
				}
				if (isset($data['design_product_title_img'])) {
					$this->db->query("UPDATE " . DB_PREFIX . "product SET design_product_title_img = '" . $this->db->escape($data['design_product_title_img']) . "' WHERE product_id = '" . (int)$product_id . "'");
				}
			]]></add>
		</operation>			
	</file>	
	
	<!-- get value from database -->
	<file name="catalog/model/catalog/product.php">
		<operation>
			<search position="after"><![CDATA[$query->row['name'],]]></search>
			<add><![CDATA[ 
				'design_product_id'         => $query->row['design_product_id'],
				'design_product_title_img'	=> $query->row['design_product_title_img'],
			]]></add>
		</operation>		
	</file>
	
	<!-- get value of field in front-end -->
	<file name="catalog/controller/product/product.php">
		<operation>
			<search position="before"><![CDATA[$data['heading_title'] = $product_info['name'];]]></search>
			<add><![CDATA[
				$this->load->language('module/tshirtecommerce');
				$data['tshirt_text_price'] = $this->language->get('tshirt_text_price_of_print');
				$data['tshirt_text_button_custom'] = $this->language->get('tshirt_text_button_custom');
				
				if(!defined('ROOT'))
					define('ROOT', str_replace('system/', 'tshirtecommerce', DIR_SYSTEM));
				if(!defined('DS'))
					define('DS', DIRECTORY_SEPARATOR);
				include_once ROOT . DS . 'includes' . DS . 'functions.php';
				$dg = new dg();
				$lang = $dg->lang();
				
				$data['tshirtecommerce_label_price_of_print'] 		= $lang['tshirtecommerce_label_price_of_print'];
				$data['tshirtecommerce_button_custom_your_design'] 	= $lang['tshirtecommerce_button_custom_your_design'];
				$data['tshirtecommerce_warning_alert_order'] 		= $lang['tshirtecommerce_warning_alert_order'];
				$data['tshirtecommerce_printing_type'] 				= $lang['tshirtecommerce_printing_type'];
				
				$data['oc_quantity'] =  0;
				if (isset($product_info['quantity']))
				{
					$data['oc_quantity'] = $product_info['quantity'];
				}
				$data['oc_minimum'] =  0;
				if (isset($product_info['minimum']))
				{
					$data['oc_minimum'] = $product_info['minimum'];
				}
				if (isset($product_info['design_product_id']))
				{
					$data['design_product_id'] = $product_info['design_product_id'];
				}
				else
				{
					$data['design_product_id'] =  '';
				}
				
				if (isset($product_info['design_product_title_img']))
				{
					$data['design_product_title_img'] = $product_info['design_product_title_img'];
					$temp = explode('::', $data['design_product_title_img']);
					if (isset($temp[2]))
					{
						if ($data['design_product_id'] != '')
						{
							$data['design_print_price'] = (float)$temp[2];
							$data['design_print_price_lable'] = $this->currency->format($data['design_print_price'], $this->session->data['currency']);
						}
						else
						{
							$data['design_print_price'] =  0;
						}
					}
					else
					{
						$data['design_print_price'] =  0;
					}
				}
				else
				{
					$data['design_product_title_img'] =  '';
					$data['design_print_price'] =  0;
				}
			]]></add>
		</operation>		
	</file>
	
	<!-- add button custom design -->
	<file name="catalog/view/theme/*/template/product/product.tpl">
		<operation>
			<search position="after"><![CDATA[<div id="product">]]></search>
			<add><![CDATA[
				<?php $e_validate_input_order = false; ?>
				<ul class="list-unstyled">
					<?php
						$design_product_id_arr = explode(':', $design_product_id);
						$e_design_product_id = 0;
						if(count($design_product_id_arr) > 1)
							$e_design_product_id = isset($design_product_id_arr[2]) ? $design_product_id_arr[2] : 0;
						else
							$e_design_product_id = $design_product_id;
						
						$file = dirname(DIR_SYSTEM) . '/tshirtecommerce/data/products.json';
						if (file_exists($file))
						{			
							$string = file_get_contents($file);
							if ($string != false)
							{
								$e_products = json_decode($string);
								if ( isset($e_products->products) && count($e_products->products) > 0)
								{
									foreach($e_products->products as $values)
									{
										if(isset($e_design_product_id) && $e_design_product_id != '' && $e_design_product_id == $values->id && isset($values->show_attribute))
										{ ?>
											<div class="row designer-attributes">
												<style>
													.designer-attributes{border-bottom: 1px dashed #ddd;border-top: 1px dashed #ddd;clear: both;display: block;float: left;margin: 16px 0;padding: 10px 0;width: 100%;}
													.designer-attributes .list-colors{float: left;width: 100%;}
													.designer-attributes .list-colors > a{float: left;height: 24px;margin: 8px;outline: 1px solid #ccc;cursor: pointer;}
													.designer-attributes .list-colors > a.active{border-radius: 50%;-webkit-border-radius:50%;-moz-border-radius: 50%;;overflow: hidden;border: 1px solid #007aff;outline: none;}
													.designer-attributes .list-colors > a span{float: left;height: 24px;}
													.p-color-sizes.list-number{list-style: outside none none;float: left;margin: 0;padding: 0;}
													.p-color-sizes.list-number > li:first-child{margin-left:0;}
													.p-color-sizes.list-number > li{float:left;margin: 0 6px;text-align: center}
													.p-color-sizes.list-number > li label{clear: both;display: block;font-size: 12px;}
													.p-color-sizes.list-number > li > input{clear: both;display: block;float:left;padding: 4px;text-align: center;;width:40px;}
												</style>
												<script>
													// active link color
													function loadProductDesign(e)
													{
														if (typeof jQuery(e).data('color') != 'undefined')
														{
															var color = jQuery(e).data('color');
															var href = jQuery(e).attr('href');
															if(color != '')
																href = href + '&color='+color;
															window.location.href = href;
															return false;
														}
														return true;
													}
													// click change color in page product detail
													function e_productColor(e)
													{
														var parent = jQuery(e).parent();
														parent.children('.bg-colors').removeClass('active');
														
														// add data
														var elm = jQuery(e);
														jQuery('.designer_color_index').attr('name', 'colors['+elm.data('index')+']').val(elm.data('color'));
														jQuery('.designer_color_hex').val(elm.data('color'));
														jQuery('.designer_color_title').val(elm.attr('title'));
														jQuery('.e-custom-product').data('color', elm.data('color'));
														elm.addClass('active');
														jQuery('#button-design').attr('data-color', jQuery(e).attr('data-color'));
														jQuery('#e_color_hex').val(jQuery(e).attr('data-color'));
														
													}
													function e_tshirt_attributes(e, index)
													{
														var quantity = 0;
														jQuery('.dg-poduct-fields').find('input.size-number').each( function(){
															quantity = quantity + parseInt(jQuery(this).val()=='' ? 0 : jQuery(this).val());
														});
														jQuery('#input-quantity').val(quantity);
													}
													function e_validate_num(evt, e)
													{
														var charCode = ( evt.which ) ? evt.which : event.keyCode;
														if(charCode != 43 && charCode != 45 && (charCode == 46 || jQuery( e ).val().indexOf('.') == -1) && (charCode  < 48 || charCode > 57)) 
															return false;
														
														return true
													}
												</script>
												<?php if(isset($values->design) && isset($values->design->color_hex)) : ?>
												<div class='list-colors' style='margin-bottom:15px;'>
													<?php $color_hex_count = count($values->design->color_hex);
													for($color_hex_c = 0; $color_hex_c < $color_hex_count; $color_hex_c++) : ?>
													<a href="javascript:void(0);" onclick="e_productColor(this)" data-color="<?php echo $values->design->color_hex[$color_hex_c] ?>" data-index="<?php echo $color_hex_c ?>" class="bg-colors <?php if(isset($design_product_id_arr[3]) && $values->design->color_hex[$color_hex_c] == $design_product_id_arr[3]) {echo 'active';}else{if($color_hex_c==0) echo 'active';}?>" title="<?php echo $values->design->color_title[$color_hex_c] ?>"><span style="width:24px;background-color:#<?php echo $values->design->color_hex[$color_hex_c] ?>;"></span></a>
													<?php endfor; ?>
													<input type='hidden' value='<?php echo (isset($design_product_id_arr[0]) ? $design_product_id_arr[0] : '') ?>' name='design[rowid]' id='e_rowid' />
													<input type="hidden" value="<?php echo (isset($design_product_id_arr[3]) ? $design_product_id_arr[3] : $values->design->color_hex[0]) ?>" id='e_color_hex' name="design[color_hex]" />
													<input type="hidden" value="<?php echo $values->design->color_title[0] ?>" name="design[color_title]" />
													<input type="hidden" value="<?php echo $values->id ?>" name="design_product_id" />
													<input type="hidden" value="<?php echo $values->id ?>" name="design[design_product_id]" />
													<input type="hidden" value="" name="design[images]" />
													<input type="hidden" value="1" name="design[idea]" />
												</div>
												<?php endif; ?>
												
												<?php if(isset($values->show_attribute) && $values->show_attribute == 1 && ! empty($values->attributes))
												{
													$e_validate_input_order = true; ?>
												<style>#input-quantity, [for="input-quantity"]{display:none;}</style>
												<div class='product-attributes'>
													<input type='hidden' value='<?php echo $oc_minimum ?>' id='e-input-min-order' />
													<input type='hidden' value='<?php echo $oc_quantity ?>' id='e-input-max-order' />
													<?php $e_attr_count = count($values->attributes->name);
													echo '<input type="hidden" value="'.$product_id.'" name="design[product_id]" />';
													for($ia = 0; $ia < $e_attr_count; $ia++) : ?>
													<div class='form-group product-fields' style='margin-bottom:0!important'><p><strong><?php echo $values->attributes->name[$ia] ?></strong></p></div>
													<div class='dg-poduct-fields'>
														<input type='hidden' value='<?php echo $values->attributes->name[$ia] ?>' name='design[options][<?php echo $ia ?>][name]' />
														<input type='hidden' value='<?php echo $values->attributes->type[$ia] ?>' name='design[options][<?php echo $ia ?>][type]' />
														<?php 
														switch($values->attributes->type[$ia])
														{
															case 'textlist':
																echo "<ul id='e-input-options' class='p-color-sizes list-number col-md-12' style='width:100%'>";
																$iaj = 0;
																foreach($values->attributes->titles[$ia] as $value)
																{
																	echo "<li style='padding-bottom:10px'>";
																	echo "<label>";
																	if(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] > 0)
																	{
																		echo $value . '(+' . $values->attributes->prices[$ia][$iaj] . ')';
																	}
																	else
																	{
																		echo $value;
																	}
																	echo "</label>";
																	if ($iaj == 0)
																	{
																		echo "<input type='text' class='form-control input-sm size-number' name='design[options][$ia][value][$value]' value='$oc_minimum' onchange='e_tshirt_attributes(this, $iaj)' onkeypress='return e_validate_num(event, this)' />";
																	}
																	else
																	{
																		echo "<input type='text' class='form-control input-sm size-number' name='design[options][$ia][value][$value]' value='0' onchange='e_tshirt_attributes(this, $iaj)' onkeypress='return e_validate_num(event, this)' />";
																	}
																	echo "<input type='hidden' name='design[options][$ia][price][$value]' value='".(isset($values->attributes->prices[$ia][$iaj]) ? $values->attributes->prices[$ia][$iaj] : 0)."' />";
																	$iaj++;
																}
																break;
															case 'checkbox':
																$iaj = 0;
																echo "<div class='form-group'>";
																foreach($values->attributes->titles[$ia] as $value)
																{
																	echo '<p><label class="checkbox-inline">';
																	if(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] > 0)
																	{
																		echo "<input type='checkbox' name='design[options][$ia][value][$iaj]' value='$value' />";
																		echo $value .'(+' . $values->attributes->prices[$ia][$iaj] . ')';
																	}
																	else
																	{
																		echo "<input type='checkbox' name='design[options][$ia][value][$iaj]' value='$value' />";
																		echo $value;
																	}
																	echo '</label></p>';
																	$iaj++;
																}
																echo '</div>';
																break;
															case 'selectbox':
																$iaj = 0;
																echo "<div class='form-group'>";
																echo "<select class='form-control input-sm' name='design[options][$ia][value]'>";
																foreach($values->attributes->titles[$ia] as $value)
																{
																	if(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] > 0)
																		echo "<option value='$value'>$value (+".$values->attributes->prices[$ia][$iaj].")</option>";
																	else
																		echo "<option value='$value'>$value</option>";
																	$iaj++;
																}
																echo '</select>';
																echo '</div>';
																break;
															case 'radio';
																$iaj = 0;
																echo "<div class='form-group'>";
																foreach($values->attributes->titles[$ia] as $value)
																{
																	echo '<p><label class="radio-inline">';
																	if(isset($values->attributes->prices[$ia][$iaj]) && $values->attributes->prices[$ia][$iaj] > 0)
																	{
																		echo "<input type='radio' value='$value' name='design[options][$ia][value]' />";
																		echo $value .'(+' . $values->attributes->prices[$ia][$iaj] . ')';
																	}
																	else
																	{
																		echo "<input type='radio' value='$value' name='design[options][$ia][value][$value]' />";
																		echo $value;
																	}
																	echo '</label></p>';
																	$iaj++;
																}
																echo '</div>';
																break;
															default:
																break;
														}
														?>
													</div>
													<?php endfor; 
													echo '<input type="hidden" value="'.$tshirtecommerce_printing_type.'" name="design[options]['.$e_attr_count.'][name]" />';
													echo '<input type="hidden" value="printing" name="design[options]['.$e_attr_count.'][type]" />';
													echo '<input type="hidden" value="'. $values->print_type .'" name="design[options]['.$e_attr_count.'][value]" />';
													?>
												</div>
												<div class='clear:both;'></div>
												<?php } ?>
											</div>
										<?php }
									}
								}
							}
						}
					?>
				</ul>
			]]></add>
		</operation>
		
		<operation>
			<search position="before"><![CDATA[<button type="button" id="button-cart"]]></search>
			<add><![CDATA[
				<?php
				if(isset($design_product_id) && $design_product_id != '') {
					$check_idea = explode(':', $design_product_id);
					$parent_id = $product_id;
					if (count($check_idea) > 1)
					{ ?>
						<?php if (isset($design_print_price) && $design_print_price != 0) { ?>
						<p><label class="control-label"><?php echo $tshirtecommerce_label_price_of_print; ?> <strong>+<?php echo $design_print_price_lable; ?></strong></label></p>
						<input name='design[oc_price_of_print]' type='hidden' value='<?php echo $design_print_price ?>' />
						<?php } ?>
					<?php } ?>
					<div style='clear:both'></div>
					<p><a id="button-design" data-color='' class="btn btn-success btn-lg btn-block" onclick='return loadProductDesign(this);' 
						href="index.php?route=tshirtecommerce/designer&product_id=<?php echo $design_product_id; ?>&parent_id=<?php echo $parent_id; ?>"><?php echo $tshirtecommerce_button_custom_your_design; ?></a>
					</p>
				<?php } ?>
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA[$('#button-cart').on('click', function() {]]></search>
			<add><![CDATA[
				<?php if($e_validate_input_order === TRUE) : ?>
				var min_order 	= parseInt(document.getElementById('e-input-min-order').value);
				var max_order 	= parseInt(document.getElementById('e-input-max-order').value);
				var curr_order 	= parseInt(document.getElementById('input-quantity').value);
				//var quantity 	= 0;
				if(curr_order < min_order || curr_order > max_order)
				{
					alert('<?php echo $tshirtecommerce_warning_alert_order.' ' ?>' + min_order);
					return false;
				}
				<?php endif; ?>
			]]></add>
		</operation>
		
	</file>
	<!-- custom add to cart -->
	<file name="system/library/cart.php">
		<operation>
			<search position="after"><![CDATA[$option_data = array();]]></search>
			<add><![CDATA[
				if ( isset($options['design']) )
				{
					$option_price = $option_price + (isset($options['design']['price']) ? $options['design']['price'] : 0);
					$design = $options['design'];
				}
				else
				{
					$design = false;
				}
			]]></add>
		</operation>
		
		<operation>
			<search position="before"><![CDATA[$this->data[$key] = array(]]></search>
			<add><![CDATA[
				if ($design !== FALSE)
				{
					if(isset($design['price']))
					{
						$option_price = $option_price + $design['price'];
					}
					
					// price with [attributes]
					$price_attributes = 0;
					$e_design = new \stdClass();
					$e_attributes = new \stdClass();
					$file = dirname(DIR_SYSTEM) . '/tshirtecommerce/data/products.json';
					if (file_exists($file))
					{
						$string = file_get_contents($file);
						if ($string != false)
						{
							$e_products = json_decode($string);
							if ( isset($e_products->products) && count($e_products->products) > 0 && isset($design['design_product_id']))
							{
								foreach($e_products->products as $values)
								{
									if($values->id == $design['design_product_id'])
									{
										$e_design = $values->design;
										$e_attributes = $values->attributes;
										break;
									}
								}
							}
						}
					}
					if(isset($e_attributes) && isset($e_attributes->type))
					{
						foreach($e_attributes->type as $type_idx => $type_val)
						{
							foreach($design['options'] as $curr_val)
							{
								if($type_val == $curr_val['type'] && isset($curr_val['value']))
								{
									switch($curr_val['type'])
									{
										case 'textlist':
											foreach($curr_val['value'] as $tlkey => $tlval)
											{
												if($tlval > 0)
												{
													foreach($e_attributes->titles[$type_idx] as $idx => $val)
													{
														if($tlkey == $val && isset($e_attributes->prices[$type_idx]) && isset($e_attributes->prices[$type_idx][$idx])) 
															$price_attributes += $e_attributes->prices[$type_idx][$idx] * $tlval / $quantity;
													}
												}
											}
											break;
										case 'checkbox':
											foreach($curr_val['value'] as $tlval)
											{
												if(!empty($tlval))
												{
													foreach($e_attributes->titles[$type_idx] as $idx => $val)
													{
														if($tlval == $val && isset($e_attributes->prices[$type_idx]) && isset($e_attributes->prices[$type_idx][$idx])) 
															$price_attributes += $e_attributes->prices[$type_idx][$idx];
													}
												}
											}
											break;
										case 'selectbox':
										case 'radio':
											if(!empty($curr_val['value']))
											{
												foreach($e_attributes->titles[$type_idx] as $idx => $val)
												{
													if($curr_val['value'] == $val && isset($e_attributes->prices[$type_idx]) && isset($e_attributes->prices[$type_idx][$idx])) 
														$price_attributes += $e_attributes->prices[$type_idx][$idx];
												}
											}
											break;
										default:
											break;
									}
								}
							}
						}
					}
					$option_price += $price_attributes;

					// prite with [price of print]
					if(isset($design['oc_price_of_print']))
					{
						$option_price += $design['oc_price_of_print'];
					}
					
					// price with [product design > price]
					if(isset($design['color_hex']) && isset($e_design) && isset($e_design->color_hex) && isset($e_design->price))
					{
						foreach($e_design->color_hex as $idx=>$color_hex)
						{
							if($color_hex == $design['color_hex'])
							{
								$option_price += (isset($e_design->price[$idx]) ? $e_design->price[$idx] : 0);
								break;
							}
						}
					}
				}
			]]></add>
		</operation>
		
		<operation>
			<search position="before"><![CDATA[$product_discount_query =]]></search>
			<add><![CDATA[
				$discount_quantity = $quantity;
			]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[$reward * $quantity,]]></search>
			<add><![CDATA[
				'design' => $design,
			]]></add>
		</operation>		
	</file>
	<file name="catalog/controller/checkout/cart.php">
		<operation>
			<search position="before"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				if(!defined('ROOT'))
					define('ROOT', str_replace('system/', 'tshirtecommerce', DIR_SYSTEM));
				if(!defined('DS'))
					define('DS', DIRECTORY_SEPARATOR);
				include_once ROOT . DS . 'includes' . DS . 'functions.php';
				$dg = new dg();
				$lang = $dg->lang();
				
				$data['tshirtecommerce_designer_cart_edit'] = $lang['designer_cart_edit'];
			
				if (isset($product['design']) && $product['design'] != false && isset($product['design']['rowid']))
				{					
					$design = $product['design'];
					
					$item = $this->db->query("SELECT product_id, design_product_id FROM `" . DB_PREFIX . "product` WHERE status = 1 AND product_id = '".$product['design']['product_id']."'");
					$design_product_id = 0;
					if ($item->num_rows)
					{
						$design_product_id = $item->row['design_product_id'];
					}
					$product['design']['design_product_id'] = $design_product_id;
					// images
					if (isset($design['images']))
					{
						$images = json_decode(str_replace('&quot;', '"', $design['images']), true);
						
						if (count($images) > 0)
						{
							if (isset($this->request->server['HTTPS']) && (($this->request->server['HTTPS'] == 'on') || ($this->request->server['HTTPS'] == '1'))) {
								$base_url = $this->config->get('config_ssl');
							} else {
								$base_url = $this->config->get('config_url');
							}
							$img = '';
							foreach($images as $view => $src)
							{
								$img .= '<a href="'.$base_url.'/tshirtecommerce/'.$src.'"><img style="width:100px; margin:1%;" src="'.$base_url.'/tshirtecommerce/'.$src.'" alt="" title="" class="img-thumbnail"></a>';
							}
							$design_option = array(
								'name'	=> 'Images',
								'value'	=> '<br /><div>'.$img.'</div>'
							);
							$option_data[] = $design_option;
						}
					}
					
					// colors
					$design_option = array(
						'name'	=> 'Color',
						'value'	=> '<span title="'.$design['color_title'].'" style="background-color:#'.$design['color_hex'].';display:inline-block;border:1px solid #ccc;width:25px;height:25px;cursor:pointer;outline:1px solid #229BCA;margin-left 4px;"></span>'
					);
					$option_data[] = $design_option;
					
					// options
					if (isset($design['options']) && $design['options'] != '[]')
					{
						if (is_string($design['options']))
							$design_options = json_decode( str_replace('&quot;', '"', $design['options']) );
						else
							$design_options = $design['options'];
												
						$html = '';
						for($i=0; $i<count($design_options); $i++)
						{
							if (empty($design_options[$i]['value'])) continue;
							
							if (is_string($design_options[$i]['value']) && $design_options[$i]['value'] != '')
							{
								$html .= '<dt>'.$design_options[$i]['name'].': '.$design_options[$i]['value'].'</dt>';
							}
							else if (count($design_options[$i]['value']) > 0)
							{
								$html .= '<dt>'.$design_options[$i]['name'].': </dt>';
								
								$html .=  '<dd>';
								foreach ($design_options[$i]['value'] as $name => $value)
								{
									if($design_options[$i]['type'] == 'checkbox')
									{
										$html .=  $value. '; ';
									}
									else
									{
										if($value != '0' && $value != 0)
											$html .=  $name.'  -  '.$value. '; ';
									}
								}
								$html .=  '</dd>';
							}
						}
						$design_option = array(
							'name'	=> 'Options',
							'value'	=> $html
						);
						$option_data[] = $design_option;
					}
					
					// teams
					if (isset($design['teams']) && isset($design['teams']['name']) )
					{
						$table = '<table class="table table-bordered">'
							. 		'<thead>'
							. 			'<tr>'
							. 				'<th>Name</th>'
							. 				'<th>Number</th>'
							. 				'<th>Sizes</th>'
							. 			'</tr>'
							. 		'</thead>'
							. 		'<tbody>';
							
						for($i=1; $i<=count($design['teams']['name']); $i++ )
						{
							$size = explode('::', $design['teams']['size'][$i]);
							$table .=	'<tr>'
								.			'<td>'.$design['teams']['name'][$i].'</td>'
								.			'<td>'.$design['teams']['number'][$i].'</td>'
								.			'<td>'.$size[0].'</td>'
								.		'</tr>';
						}
						
						$table .= '</tbody></table>';
						
						$design_option = array(
							'name'	=> 'Team',
							'value'	=> $table
						);
						$option_data[] = $design_option;
					}	
				}
				else
				{
					$design = '';					
				}				
			]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				'order_id' => (isset($product['design']['rowid']) ? $product['design']['rowid'] : 0),
				'parent_id' => (isset($product['design']['product_id']) ? $product['design']['product_id'] : 0),
				'design_product_id' => (isset($design_product_id) ? $design_product_id : 0),
			]]></add>
		</operation>
		
		<operation>
			<search position="before"><![CDATA[$this->cart->add($this->request->post['product_id']]]></search>
			<add><![CDATA[
				if (isset($this->request->post['design'])) {
					$design = $this->request->post['design'];
					$option['design'] = $design;
				}
			]]></add>
		</operation>
	</file>
	
	
	<file name="catalog/controller/checkout/confirm.php">
		<operation>
			<search position="before"><![CDATA[$order_data['products'][] = array(]]></search>
			<add><![CDATA[
				if (isset($product['design']))
				{
					$design_product_id = '';
					if(isset($product['design']['product_id']))
					{
						$item = $this->db->query("SELECT product_id, design_product_id FROM `" . DB_PREFIX . "product` WHERE status = 1 AND product_id = '".$product['design']['product_id']."'");
						if ($item->num_rows)
						{
							$design_product_id = $item->row['design_product_id'];
						}
					}
					$product['design']['design_product_id'] = $design_product_id;
					
					$design = json_encode($product['design']);
				}
				else
				{
					$design = '';
				}
			]]></add>
		</operation>
		<operation>
			<search position="before"><![CDATA[$this->tax->getTax($product['price'], $product['tax_class_id']),]]></search>
			<add><![CDATA[
			'design'	 => $design,
			]]></add>
		</operation>
	</file>
	
	<file name="catalog/model/checkout/order.php">
		<operation>
			<search position="after" index="1"><![CDATA[$order_product_id = $this->db->getLastId();]]></search>
			<add><![CDATA[
				if ( isset($product['design']) && $product['design'] != '' )
				{
					$this->db->query("INSERT INTO " . DB_PREFIX . "tshirtdesign_order SET order_product_id = '" . (int)$order_product_id . "', options = '" . $this->db->escape($product['design']) . "'");
				}
			]]></add>
		</operation>
		
		<!-- Get information to send mail action -->
		<operation>
			<search position="after"><![CDATA[$data = array();]]></search>
			<add><![CDATA[
				$this->load->model('tshirtecommerce/order');
				if (isset($this->request->server['HTTPS']) && (($this->request->server['HTTPS'] == 'on') || ($this->request->server['HTTPS'] == '1'))) {
					$base_url = $this->config->get('config_ssl');
				} else {
					$base_url = $this->config->get('config_url');
				}	
				$data['base_url'] = $base_url;
			]]></add>
		</operation>
		
		<!-- get setting for downloadable -->
		<operation>
			<search position="before"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				if(!defined('ROOT'))
				{
					define('ROOT', str_replace('system/', 'tshirtecommerce', DIR_SYSTEM));
				}
				if(!defined('DS'))
				{
					define('DS', DIRECTORY_SEPARATOR);
				}
				if(file_exists(ROOT . DS . 'includes' . DS . 'functions.php'))
				{
					include_once ROOT . DS . 'includes' . DS . 'functions.php';
					$dg 	= new dg();
					$lang 	= $dg->lang();
					
					$data['tshirtecommerce_designer_cart_edit'] 		= $lang['designer_cart_edit'];
					$data['tshirtecommerce_link_text_download'] 		= $lang['tshirtecommerce_link_text_download'];
					$data['tshirtecommerce_link_title_download'] 		= $lang['tshirtecommerce_link_title_download'];
					$data['tshirtecommerce_link_title_edit'] 			= $lang['tshirtecommerce_link_title_edit'];
					$data['tshirtecommerce_view_front'] 				= $lang['tshirtecommerce_view_front'];
					$data['tshirtecommerce_view_left'] 					= $lang['tshirtecommerce_view_left'];
					$data['tshirtecommerce_view_right'] 				= $lang['tshirtecommerce_view_right'];
					$data['tshirtecommerce_view_back'] 					= $lang['tshirtecommerce_view_back'];
					$data['ts_designer_clipart_edit_name'] 				= $lang['designer_clipart_edit_name'];
					$data['ts_designer_clipart_edit_number'] 			= $lang['designer_clipart_edit_number'];
					$data['tshirtecommerce_head_text_sizes'] 			= $lang['tshirtecommerce_head_text_sizes'];
					$data['tshirtecommerce_link_view_design'] 			= $lang['tshirtecommerce_link_view_design'];
					$data['tshirtecommerce_label_or_download_design'] 	= $lang['tshirtecommerce_label_or_download_design'];
					$data['tshirtecommerce_label_color'] 				= $lang['tshirtecommerce_label_color'];
				}
				$this->load->model('setting/setting');
				if(null !== $this->config->get('tshirtecommerce_downloadable'))
					$data['tshirtecommerce_downloadable'] = $this->config->get('tshirtecommerce_downloadable');
				else
					$data['tshirtecommerce_downloadable'] = 0;

				$this->load->model('catalog/product');
				$e_products = $this->model_catalog_product->getProduct($product['product_id']);
				
				$design_product_id = '';
				if(isset($e_products) && isset($e_products['design_product_id'])) {
					$design_product_id = $e_products['design_product_id'];
				}
			]]></add>
		</operation>
		
		<!-- get data for add link Edit Design to order info page -->
		<operation>
			<search position="after"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				'design' 	=> $this->model_tshirtecommerce_order->getItem($product['order_product_id'], $product['product_id']),
				'link_edit' => 'index.php?route=tshirtecommerce/designer&product_id=',
				'design_product_id' => $design_product_id,
			]]></add>
		</operation>
	</file>
	
	<!-- order info of design -->
	<file name="admin/controller/sale/order.php">
		<operation>
			<search position="after" index="2"><![CDATA[$this->model_sale_order->getOrderProducts($this->request->get['order_id']);]]></search>
			<add><![CDATA[
				if(!defined('ROOT'))
				{
					define('ROOT', str_replace('system/', 'tshirtecommerce', DIR_SYSTEM));
				}
				if(!defined('DS'))
				{
					define('DS', DIRECTORY_SEPARATOR);
				}
				if(file_exists(ROOT . DS . 'includes' . DS . 'functions.php'))
				{
					include_once ROOT . DS . 'includes' . DS . 'functions.php';
					$dg = new dg();
					$lang = $dg->lang();
					
					$data['tshirtecommerce_designer_cart_edit'] 		= $lang['designer_cart_edit'];
					$data['tshirtecommerce_link_text_download'] 		= $lang['tshirtecommerce_link_text_download'];
					$data['tshirtecommerce_link_title_download'] 		= $lang['tshirtecommerce_link_title_download'];
					$data['tshirtecommerce_link_title_edit'] 			= $lang['tshirtecommerce_link_title_edit'];
					$data['tshirtecommerce_view_front'] 				= $lang['tshirtecommerce_view_front'];
					$data['tshirtecommerce_view_left'] 					= $lang['tshirtecommerce_view_left'];
					$data['tshirtecommerce_view_right'] 				= $lang['tshirtecommerce_view_right'];
					$data['tshirtecommerce_view_back'] 					= $lang['tshirtecommerce_view_back'];
					$data['ts_designer_clipart_edit_name'] 				= $lang['designer_clipart_edit_name'];
					$data['ts_designer_clipart_edit_number'] 			= $lang['designer_clipart_edit_number'];
					$data['tshirtecommerce_head_text_sizes'] 			= $lang['tshirtecommerce_head_text_sizes'];
					$data['tshirtecommerce_link_view_design'] 			= $lang['tshirtecommerce_link_view_design'];
					$data['tshirtecommerce_label_or_download_design'] 	= $lang['tshirtecommerce_label_or_download_design'];
					$data['tshirtecommerce_label_color'] 				= $lang['tshirtecommerce_label_color'];
				}
				$this->load->model('tshirtecommerce/order');
				if (isset($this->request->server['HTTPS']) && (($this->request->server['HTTPS'] == 'on') || ($this->request->server['HTTPS'] == '1'))) {
					$base_url = HTTPS_CATALOG;
				} else {
					$base_url = HTTP_CATALOG;


				}	
				$data['base_url'] = $base_url;
				$data['tshirtecommerce_url'] = $this->url->link('tshirtecommerce/designer', '', 'SSL');
				$data['tshirtecommerce_url'] = str_replace('/admin', '', $data['tshirtecommerce_url']);
			]]></add>
		</operation>
		<operation>
			<search position="after"><![CDATA['order_product_id' => $product['order_product_id'],]]></search>
			<add><![CDATA[
			'design' => $this->model_tshirtecommerce_order->getItem($product['order_product_id'], $product['product_id']),
			]]></add>
		</operation>
	</file>
	
	<file name="admin/view/template/sale/order_info.tpl">
		<operation>
			<search position="after"><![CDATA[<td class="text-left"><a href="<?php echo $product['href']; ?>"><?php echo $product['name']; ?></a>]]></search>
			<add><![CDATA[
			<br />
			<?php if ( isset($product['design']) && $product['design'] != false) { 
				$design = $product['design'];
				if(isset($design->design_product_id) && !empty($design->design_product_id))
				{
					$_temp_arr = explode(':', $design->design_product_id);
					echo "<p class='form-group'>";
					if(count($_temp_arr) > 1)
					{
						$_key = $_temp_arr[0].':'.$_temp_arr[1].':'.$_temp_arr[2].':'.$design->color_hex;
						
						echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$_key. '&parent_id=' . $design->product_id ."' title='".$tshirtecommerce_link_title_edit."' target='_blank'><strong>".$tshirtecommerce_link_view_design."</strong></a>";

						if(!isset($design->images) || empty($design->images))
						{
							echo ' '. $tshirtecommerce_label_or_download_design .':';
							echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=front'><strong>".$tshirtecommerce_view_front."</strong></a> - ";
							echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=back'><strong>".$tshirtecommerce_view_back."</strong></a> - ";
							echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=left'><strong>".$tshirtecommerce_view_left."</strong></a> - ";
							echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=right'><strong>".$tshirtecommerce_view_right."</strong></a>";
						}
					}
					else
					{
						if(isset($design->images) && !empty($design->images))
						{
							echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$design->design_product_id."&parent_id=".$design->product_id."&cart_id=".$design->rowid."' title='' target='_blank'><strong>".$tshirtecommerce_designer_cart_edit."</strong></a>";
						}
					}
					echo "</p>";
				}
				
				if(isset($design->color_title)) { ?>
				<small><strong><?php echo $tshirtecommerce_label_color ?>:</strong> <span title="<?php echo $design->color_title; ?>" style="background-color:#<?php echo $design->color_hex; ?>;display:inline-block;border:1px solid #ccc;width:25px;height:25px;cursor:pointer;outline:1px solid #229BCA;margin-left 4px;"></span></small><br />
				<?php } ?>
				
				<?php
				// options
				if (isset($design->options) && $design->options != '[]')
				{
					if (is_string($design->options))
						$design_options = json_decode( str_replace('&quot;', '"', $design->options) );
					else
						$design_options = $design->options;						

					$html = '';
					if (count($design_options))
					{
						foreach($design_options as $option)
						{					
							if (isset($option->value))
							{
								if (is_string($option->value) && $option->value != '')
								{
									$html .= '<dt>'.$option->name.': '.$option->value.'</dt>';
								}
								else if (count($option->value) > 0)
								{
									$html .= '<dt>'.$option->name.': </dt>';
									
									$html .=  '<dd>';
									foreach ($option->value as $name => $value)
									{
										if($option->type == 'checkbox')
										{
											$html .=  $value. '; ';
										}
										else
										{
											if($value != '0' && $value != 0) 
												$html .=  $name.'  -  '.$value. '; ';
										}
									}
									$html .=  '</dd>';
								}
							}
						}
					}
					echo $html;
				}
				
				// teams
				if (isset($design->teams) && isset($design->teams->name) )
				{
					$teams = json_decode( json_encode($design->teams), true );
					$table = '<table class="table table-bordered">'
						. 		'<thead>'
						. 			'<tr>'
						. 				'<th>'.$ts_designer_clipart_edit_name.'</th>'
						. 				'<th>'.$ts_designer_clipart_edit_number.'</th>'
						. 				'<th>'.$tshirtecommerce_head_text_sizes.'</th>'
						. 			'</tr>'
						. 		'</thead>'
						. 		'<tbody>';
						
					for($i=1; $i<=count($teams['name']); $i++ )
					{
						$size = explode('::', $teams['size'][$i]);
						$table .=	'<tr>'
							.			'<td>'.$teams['name'][$i].'</td>'
							.			'<td>'.$teams['number'][$i].'</td>'
							.			'<td>'.$size[0].'</td>'
							.		'</tr>';
					}
					$table .= '</tbody></table>';	
					echo $table;
				}
				
				// images
				if (isset($design->images))
				{
					$images = json_decode(str_replace('&quot;', '"', $design->images), true);
					
					if (count($images) > 0)
					{								
						$img = '';
						foreach($images as $view => $src)
						{
							$img .= '<div class="img-thumbnail" style="margin:2px;">'
									. 	' <img style="width:100px;" src="'.$base_url.'/tshirtecommerce/'.$src.'" alt="" title="">'
									.	'<br />'
									.	'<a href="'.$base_url.'/tshirtecommerce/design.php?key='.$design->rowid.'&view='.$view.'" target="_blank" class="pull-right" title="'.$tshirtecommerce_link_title_download.'">'.$tshirtecommerce_link_text_download.'</a>'
									.'</div>';
						}
						echo $img;
					}
				}
			} ?>
			]]></add>
		</operation>
	</file>
	
	<!-- show design info to user -->
	<file name="catalog/controller/account/order.php">
		<operation>
			<search position="after"><![CDATA[$this->model_account_order->getOrderProducts($this->request->get['order_id']);]]></search>
			<add><![CDATA[
				if(!defined('ROOT'))
				{
					define('ROOT', str_replace('system/', 'tshirtecommerce', DIR_SYSTEM));
				}
				if(!defined('DS'))
				{
					define('DS', DIRECTORY_SEPARATOR);
				}
				if(file_exists(ROOT . DS . 'includes' . DS . 'functions.php'))
				{
					include_once ROOT . DS . 'includes' . DS . 'functions.php';
					$dg 	= new dg();
					$lang 	= $dg->lang();
					
					$data['tshirtecommerce_designer_cart_edit'] 		= $lang['designer_cart_edit'];
					$data['tshirtecommerce_link_text_download'] 		= $lang['tshirtecommerce_link_text_download'];
					$data['tshirtecommerce_link_title_download'] 		= $lang['tshirtecommerce_link_title_download'];
					$data['tshirtecommerce_link_title_edit'] 			= $lang['tshirtecommerce_link_title_edit'];
					$data['tshirtecommerce_view_front'] 				= $lang['tshirtecommerce_view_front'];
					$data['tshirtecommerce_view_left'] 					= $lang['tshirtecommerce_view_left'];
					$data['tshirtecommerce_view_right'] 				= $lang['tshirtecommerce_view_right'];
					$data['tshirtecommerce_view_back'] 					= $lang['tshirtecommerce_view_back'];
					$data['ts_designer_clipart_edit_name'] 				= $lang['designer_clipart_edit_name'];
					$data['ts_designer_clipart_edit_number'] 			= $lang['designer_clipart_edit_number'];
					$data['tshirtecommerce_head_text_sizes'] 			= $lang['tshirtecommerce_head_text_sizes'];
					$data['tshirtecommerce_link_view_design'] 			= $lang['tshirtecommerce_link_view_design'];
					$data['tshirtecommerce_label_or_download_design'] 	= $lang['tshirtecommerce_label_or_download_design'];
					$data['tshirtecommerce_label_color'] 				= $lang['tshirtecommerce_label_color'];
				}
				$this->load->model('tshirtecommerce/order');
				if (isset($this->request->server['HTTPS']) && (($this->request->server['HTTPS'] == 'on') || ($this->request->server['HTTPS'] == '1'))) {
					$base_url = $this->config->get('config_ssl');
				} else {
					$base_url = $this->config->get('config_url');
				}	
				$data['base_url'] = $base_url;
			]]></add>
		</operation>
		
		<operation>
			<search position="after"><![CDATA[$option_data,]]></search>
			<add><![CDATA[
				'design' 	=> $this->model_tshirtecommerce_order->getItem($product['order_product_id'], $product['product_id']),
			]]></add>
		</operation>
		<!-- get setting for downloadable -->
		<operation>
			<search position="before"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				$this->load->model('setting/setting');
				if(null !== $this->config->get('tshirtecommerce_downloadable'))
					$data['tshirtecommerce_downloadable'] = $this->config->get('tshirtecommerce_downloadable');
				else
					$data['tshirtecommerce_downloadable'] = 0;
			]]></add>
		</operation>
		
		<!-- get data for add link Edit Design to order info page -->
		<operation>
			<search position="after"><![CDATA[$data['products'][] = array(]]></search>
			<add><![CDATA[
				'design' 	=> $this->model_tshirtecommerce_order->getItem($product['order_product_id'], $product['product_id']),
			]]></add>
		</operation>
	</file>
	
	<file name="catalog/view/theme/*/template/account/order_info.tpl">
		<operation>
			<search position="after"><![CDATA[<td class="text-left"><?php echo $product['name']; ?>]]></search>
			<add><![CDATA[
				<br />
				<?php if ( isset($product['design']) && $product['design'] != false && isset($product['design']->rowid))
				{
					$design = $product['design'];
					
					// Show link for download design
					if(isset($design->design_product_id) && !empty($design->design_product_id))
					{
						$_temp_arr = explode(':', $design->design_product_id);
						if(count($_temp_arr) > 1)
						{
							$_key = $_temp_arr[0].':'.$_temp_arr[1].':'.$_temp_arr[2].':'.$design->color_hex;
							echo '<br /><p>';
							echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$_key. '&parent_id=' . $design->product_id ."' title='' target='_blank'><strong>".$tshirtecommerce_designer_cart_edit."</strong></a>";
							if(isset($tshirtecommerce_downloadable) && $tshirtecommerce_downloadable == 1 && (!isset($design->images) || empty($design->images)))
							{
								echo ' or Download design: ';
								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=front'><strong>".$tshirtecommerce_view_front."</strong></a> - ";
								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=back'><strong>".$tshirtecommerce_view_back."</strong></a> - ";
								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=left'><strong>".$tshirtecommerce_view_left."</strong></a> - ";
								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='$base_url/tshirtecommerce/design.php?idea=1&key=".$_key."&view=right'><strong>".$tshirtecommerce_view_right."</strong></a>";
							}
							echo '</p>';
						}
						else
						{
							if(isset($design->images) && !empty($design->images))
							{
								echo '<br /><p>';
								echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$design->design_product_id."&parent_id=".$design->product_id."&cart_id=".$design->rowid."' title='' target='_blank'><strong>".$tshirtecommerce_designer_cart_edit."</strong></a>";
								echo '</p>';
							}
						}
					}
					if(isset($design->color_title)) { ?>
					<br /><small><strong><?php echo $tshirtecommerce_label_color ?>:</strong><span title="<?php echo $design->color_title; ?>" style="background-color:#<?php echo $design->color_hex; ?>;display:inline-block;border:1px solid #ccc;width:25px;height:25px;cursor:pointer;outline:1px solid #229BCA;margin-left 4px;"></span></small><br />
					<?php } ?>
					
					<?php
					// options
					if (isset($design->options) && $design->options != '[]')
					{
						if (is_string($design->options))
							$design_options = json_decode( str_replace('&quot;', '"', $design->options) );
						else
							$design_options = $design->options;	
						
						if (is_object($design_options)) $design_options = (array) $design_options;
						
						$html = '';
						if (count($design_options))
						{
							foreach($design_options as $option)
							{					
								if (isset($option->value))
								{
									if (is_string($option->value) && $option->value != '')
									{
										$html .= '<dt>'.$option->name.': '.$option->value.'</dt>';
									}
									else if (count($option->value) > 0)
									{
										$html .= '<dt>'.$option->name.': </dt>';
										
										$html .=  '<dd>';
										foreach ($option->value as $name => $value)
										{
											if($option->type == 'checkbox')
											{
												$html .= $value. '; ';
											}
											else
											{
												if($value != '0' && $value != 0) 

													$html .=  $name.'  -  '.$value. '; ';
											}
										}
										$html .=  '</dd>';
									}
								}
							}
						}
						echo $html;
					}
					
					// teams
					if (isset($design->teams) && isset($design->teams->name) )
					{
						$teams = json_decode( json_encode($design->teams), true );
						$table = '<table class="table table-bordered">'
							. 		'<thead>'
							. 			'<tr>'
							. 				'<th>'.$ts_designer_clipart_edit_name.'</th>'
							. 				'<th>'.$ts_designer_clipart_edit_number.'</th>'
							. 				'<th>'.$tshirtecommerce_head_text_sizes.'</th>'
							. 			'</tr>'
							. 		'</thead>'
							. 		'<tbody>';
							
						for($i=1; $i<=count($teams['name']); $i++ )
						{
							$size = explode('::', $teams['size'][$i]);
							$table .=	'<tr>'
								.			'<td>'.$teams['name'][$i].'</td>'
								.			'<td>'.$teams['number'][$i].'</td>'
								.			'<td>'.$size[0].'</td>'
								.		'</tr>';
						}				
						$table .= '</tbody></table>';
						echo $table;
					}
					
					// images
					if (isset($design->images))
					{
						$images = json_decode(str_replace('&quot;', '"', $design->images), true);
						
						if (count($images) > 0)
						{								
							$img = '';
							foreach($images as $view => $src)
							{
								$img .= '<div class="img-thumbnail" style="margin:2px;">'											
										.'<a target="_blank" href="'.$base_url.'/tshirtecommerce/'.$src.'" class="pull-left" title="Click to view design"><img style="width:80px;" src="'.$base_url.'/tshirtecommerce/'.$src.'" alt="" title="'.$tshirtecommerce_link_title_edit.'"></a>';


								if(isset($tshirtecommerce_downloadable) && $tshirtecommerce_downloadable == 1)
								{
									$img .= '<br /><center><a target="_blank" href="'.$base_url.'/tshirtecommerce/design.php?key='.$design->rowid.'&view='.$view.'" title="'.$tshirtecommerce_link_title_download.'" alt="'.$tshirtecommerce_link_text_download.'">'.$tshirtecommerce_link_text_download.'</a></center>';
								}
								$img .=	'</div>';
							}
							echo $img;
						}
					}
				} ?>
			]]></add>
		</operation>
		
	</file>
	
	<file name="catalog/view/theme/*/template/mail/order.tpl">
		<operation>
			<search position="after"><![CDATA[&nbsp;<small> - <?php echo $option['name']; ?>: <?php echo $option['value']; ?></small>]]></search>
			<add><![CDATA[
				<?php } ?>
				<br />
				<?php
				if ( isset($product['design']) && $product['design'] != false)
				{
					$design = $product['design'];
					// Show link for download design
					if(isset($design->design_product_id) && !empty($design->design_product_id))
					{
						$_temp_arr = explode(':', $design->design_product_id);
						if(count($_temp_arr) > 1)
						{
							$_key = $_temp_arr[0].':'.$_temp_arr[1].':'.$_temp_arr[2].':'.$design->color_hex;
							
							echo '<br /><p>';
							echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$_key. '&parent_id=' . $design->product_id ."' title='' target='_blank'><strong>".$tshirtecommerce_designer_cart_edit."</strong></a>";
							if(isset($tshirtecommerce_downloadable) && $tshirtecommerce_downloadable == 1 && (!isset($design->images) || empty($design->images)))
							{
								echo ' '.$tshirtecommerce_label_or_download_design.': ';
								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='".$base_url."/tshirtecommerce/design.php?idea=1&key=".$_key."&view=front'><strong>".$tshirtecommerce_view_front."</strong></a><span> - </span>";
								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='".$base_url."/tshirtecommerce/design.php?idea=1&key=".$_key."&view=back'><strong>".$tshirtecommerce_view_back."</strong></a><span> - </span>";
								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='".$base_url."/tshirtecommerce/design.php?idea=1&key=".$_key."&view=left'><strong>".$tshirtecommerce_view_left."</strong></a><span> - </span>";
								echo "<a title='".$tshirtecommerce_link_title_download."' target='_blank' href='".$base_url."/tshirtecommerce/design.php?idea=1&key=".$_key."&view=right'><strong>".$tshirtecommerce_view_right."</strong></a>";
							}
							echo '</p>';
						}
						else
						{
							if(isset($design->images) && !empty($design->images))
							{
								echo '<br /><p>';
								echo "<a href='".$base_url."index.php?route=tshirtecommerce/designer&product_id=".$design->design_product_id."&parent_id=".$design->product_id."&cart_id=".$design->rowid."' title='' target='_blank'><strong>".$tshirtecommerce_designer_cart_edit."</strong></a>";
								echo '</p>';
							}
						}
					}
					if(isset($design->color_title)) { ?>
						<p style='height:25px;width:auto'><strong><?php echo $tshirtecommerce_label_color ?>:</strong></p>
						<p title='<?php echo $design->color_title; ?>' style='background-color:#<?php echo $design->color_hex ?>; height:25px; width:25px;border: 1px solid #cdcdcd;outline: 1px solid #229BCA;margin: 2px;'></p>
						<br />
					<?php } ?>

					<?php 
					// options
					if (isset($design->options) && $design->options != '[]')
					{
						if (is_string($design->options))
							$design_options = json_decode( str_replace('&quot;', '"', $design->options) );
						else
							$design_options = $design->options;						
						
						$html = '';
						if (count($design_options))
						{
							foreach($design_options as $option)
							{					
								if (isset($option->value))
								{
									if (is_string($option->value) && $option->value != '')
									{
										$html .= '<p><strong>'.$option->name.': '.$option->value.'</strong></p>';
									}
									else if (count($option->value) > 0)
									{
										$html .= '<p><strong>'.$option->name.':</strong> </p>';
										foreach ($option->value as $name => $value)
										{
											if($value != '0' && $value != 0)
												$html .=  $name.'  -  '.$value. '; ';
										}
									}
								}
							}
						}
						echo $html;
					}
					// teams
					if (isset($design->teams) && isset($design->teams->name) )
					{
						$teams = json_decode( json_encode($design->teams), true );
						$table = '<table class="table table-bordered">'
							. 		'<thead>'
							. 			'<tr>'
							. 				'<th>'.$ts_designer_clipart_edit_name.'</th>'
							. 				'<th>'.$ts_designer_clipart_edit_number.'</th>'
							. 				'<th>'.$tshirtecommerce_head_text_sizes.'</th>'
							. 			'</tr>'
							. 		'</thead>'
							. 		'<tbody>';
							
						for($i=1; $i<=count($teams['name']); $i++ )
						{
							$size = explode('::', $teams['size'][$i]);
							$table .=	'<tr>'
								.			'<td>'.$teams['name'][$i].'</td>'
								.			'<td>'.$teams['number'][$i].'</td>'
								.			'<td>'.$size[0].'</td>'
								.		'</tr>';
						}
						$table .= '</tbody></table>';
						echo $table;
					}
					// images
					if (isset($design->images))
					{
						$images = json_decode(str_replace('&quot;', '"', $design->images), true);
						if (count($images) > 0)
						{								
							$img = '';
							foreach($images as $view => $src)
							{
								$img .= '<center style="float:left;background-color: #fff;margin:2px;border: 1px solid #ddd;border-radius: 4px;display: inline-block;line-height: 1.42857;transition: all 0.2s ease-in-out 0s;padding: 4px;">';
								$img .= '<a target="_blank" href="'.$base_url.'/tshirtecommerce/'.$src.'" title="">';
								$img .= '<img style="width:70px;height:auto" src="'.$base_url.'/tshirtecommerce/'.$src.'" alt="" width="70px" />';
								if(isset($tshirtecommerce_downloadable) && $tshirtecommerce_downloadable == 1)
								{
									$img .= '<br /><a href="'.$base_url.'/tshirtecommerce/design.php?key='.$design->rowid.'&view='.$view.'" target="_blank" title="'.$tshirtecommerce_link_title_download.'">'.$tshirtecommerce_link_text_download.'</a>';
								}
								$img .= '</a>';
								$img .= '</center>';
							}

							echo $img;
						}
					} ?>
			]]></add>
		</operation>
	</file>
</modification>